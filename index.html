<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azores Accommodation Voting</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #1a1614;
            --surface: #2a2420;
            --surface-elevated: #332e28;
            --text: #e8e6e3;
            --text-dim: #9a9490;
            --volcanic: #d35400;
            --volcanic-bright: #e67e22;
            --lava: #c0392b;
            --rock: #5d5348;
            --moss: #27ae60;
            --mist: #95a5a6;
            --border: #4a433a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: linear-gradient(180deg, #0a0908 0%, #1a1614 30%, #2a2420 70%, #332e28 100%);
            background-attachment: fixed;
            color: var(--text);
            min-height: 100vh;
            padding: 2rem;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(ellipse at 30% 20%, rgba(211, 84, 0, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(192, 57, 43, 0.06) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(93, 83, 72, 0.03) 0%, transparent 60%);
            pointer-events: none;
            z-index: 0;
        }

        body::after {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(0deg, rgba(211, 84, 0, 0.05) 0%, transparent 100%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 4rem;
            animation: fadeInDown 0.8s ease-out;
            position: relative;
        }

        header::after {
            content: 'ðŸŒ‹';
            display: block;
            font-size: 2rem;
            margin-top: 1rem;
            opacity: 0.7;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2.5rem, 8vw, 5rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--volcanic), var(--volcanic-bright), var(--lava));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
            line-height: 1;
            text-shadow: 0 0 40px rgba(211, 84, 0, 0.3);
        }

        .subtitle {
            font-size: 0.875rem;
            color: var(--mist);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .view-toggle {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 3rem;
            animation: fadeIn 1s ease-out 0.2s both;
        }

        .toggle-btn {
            background: var(--surface);
            border: 2px solid var(--border);
            color: var(--text-dim);
            padding: 0.75rem 2rem;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            border-radius: 2px;
        }

        .toggle-btn:hover {
            border-color: var(--volcanic);
            color: var(--volcanic-bright);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(211, 84, 0, 0.2);
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, var(--volcanic), var(--lava));
            border-color: var(--volcanic);
            color: var(--text);
            box-shadow: 0 0 20px rgba(211, 84, 0, 0.4);
        }

        .section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .section.active {
            display: block;
        }

        .voting-area {
            background: var(--surface);
            border: 2px solid var(--border);
            padding: 2.5rem;
            margin-bottom: 2rem;
            position: relative;
            animation: slideUp 0.6s ease-out 0.3s both;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(211, 84, 0, 0.1);
            border-radius: 2px;
        }

        .voting-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--volcanic), var(--lava), var(--volcanic-bright), var(--volcanic));
            border-radius: 2px 2px 0 0;
        }

        h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: var(--text);
            background: linear-gradient(135deg, var(--volcanic-bright), var(--lava));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .instruction {
            color: var(--text-dim);
            margin-bottom: 2rem;
            font-size: 0.875rem;
            line-height: 1.6;
        }

        .rank-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 2rem;
            min-height: 400px;
        }

        .rank-item {
            background: var(--surface-elevated);
            border: 2px solid var(--border);
            padding: 1.25rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            transition: all 0.3s ease;
            position: relative;
            border-radius: 2px;
        }

        .rank-item:hover {
            border-color: var(--volcanic);
            box-shadow: 0 4px 16px rgba(211, 84, 0, 0.15);
            transform: translateX(4px);
        }

        .rank-number {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--volcanic), var(--lava));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            min-width: 50px;
            text-align: center;
            line-height: 1;
            flex-shrink: 0;
        }

        .rank-content {
            flex: 1;
            min-width: 0;
            overflow-wrap: break-word;
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .option-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
        }

        .option-price {
            font-family: 'Playfair Display', serif;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--volcanic-bright);
        }

        .option-link {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.75rem;
            transition: color 0.3s ease;
            margin-bottom: 0.75rem;
            display: inline-block;
            word-break: break-all;
            overflow-wrap: break-word;
            max-width: 100%;
        }

        .option-link:hover {
            color: var(--volcanic-bright);
        }

        .pros-cons-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 0.75rem;
        }

        .pros-section, .cons-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .section-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .pros-section .section-label {
            color: var(--moss);
        }

        .cons-section .section-label {
            color: var(--lava);
        }

        .pros-list, .cons-list {
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .pros-list li, .cons-list li {
            font-size: 0.8125rem;
            color: var(--text-dim);
            line-height: 1.4;
            padding-left: 1.25rem;
            position: relative;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .pros-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--moss);
            font-weight: 600;
        }

        .cons-list li::before {
            content: 'âœ—';
            position: absolute;
            left: 0;
            color: var(--lava);
            font-weight: 600;
        }

        .rank-controls {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            flex-shrink: 0;
        }

        .rank-btn {
            background: var(--surface);
            border: 2px solid var(--border);
            color: var(--volcanic-bright);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.25rem;
            font-weight: bold;
            border-radius: 2px;
        }

        .rank-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, var(--volcanic), var(--lava));
            border-color: var(--volcanic);
            color: var(--text);
            transform: scale(1.1);
            box-shadow: 0 0 12px rgba(211, 84, 0, 0.4);
        }

        .rank-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .submit-btn {
            background: linear-gradient(135deg, var(--volcanic), var(--lava));
            border: none;
            color: var(--text);
            padding: 1rem 3rem;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            width: 100%;
            border-radius: 2px;
            box-shadow: 0 4px 16px rgba(211, 84, 0, 0.3);
        }

        .submit-btn:hover {
            background: linear-gradient(135deg, var(--lava), var(--volcanic));
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(211, 84, 0, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .results-container {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .result-item {
            background: var(--surface);
            border: 2px solid var(--border);
            padding: 1.5rem;
            animation: slideUp 0.6s ease-out both;
            border-radius: 2px;
        }

        .result-item:nth-child(1) { animation-delay: 0.1s; }
        .result-item:nth-child(2) { animation-delay: 0.2s; }
        .result-item:nth-child(3) { animation-delay: 0.3s; }
        .result-item:nth-child(4) { animation-delay: 0.4s; }
        .result-item:nth-child(5) { animation-delay: 0.5s; }
        .result-item:nth-child(6) { animation-delay: 0.6s; }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .result-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
        }

        .result-score {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--volcanic), var(--lava));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .result-bar-container {
            background: var(--bg);
            height: 12px;
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 0.5rem;
            border-radius: 6px;
        }

        .result-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--volcanic), var(--lava), var(--volcanic-bright));
            transition: width 1s ease-out;
        }

        .result-details {
            display: flex;
            gap: 2rem;
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .confirmation {
            background: var(--moss);
            color: var(--bg);
            padding: 1rem;
            text-align: center;
            font-weight: 600;
            margin-bottom: 2rem;
            animation: slideDown 0.5s ease-out;
            border-radius: 2px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .voting-area {
                padding: 1.5rem;
            }

            .rank-number {
                font-size: 2rem;
                min-width: 40px;
            }

            .result-details {
                flex-direction: column;
                gap: 0.5rem;
            }

            .pros-cons-container {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .option-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Azores Stay</h1>
            <p class="subtitle">Rank Your Preferences</p>
        </header>

        <div class="view-toggle">
            <button class="toggle-btn active" onclick="switchView('vote')">Vote</button>
            <button class="toggle-btn" onclick="switchView('results')">Results</button>
        </div>

        <div id="vote-section" class="section active">
            <div class="voting-area">
                <h2>Rank Your Preferences</h2>
                <p class="instruction">
                    Use the arrow buttons to move options up or down to rank them from most preferred (1) to least preferred (6). 
                    Your top choice gets the most points.
                </p>
                
                <div id="rank-list" class="rank-list"></div>
                
                <button class="submit-btn" onclick="submitVote()">Submit Vote</button>
            </div>
        </div>

        <div id="results-section" class="section">
            <div class="voting-area">
                <h2>Results Summary</h2>
                <p class="instruction">
                    Results are calculated using a weighted scoring system: 1st choice = 6 points, 
                    2nd = 5 points, down to 6th = 1 point. Check the Google Sheet for detailed voting data.
                </p>
                
                <div id="results-container" class="results-container"></div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        // IMPORTANT: Replace this with your Google Apps Script Web App URL
        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbyWNrS_eaOZtQxyP9Ef2y6n9ywwaLt3bKoy0h7ig8RQJWek5TXfjilx2uaZ6Y-G7SbI/exec';
        // ========================
        
        const options = [
            { 
                id: 1, 
                name: 'Herdade do Ananas',
                price: '$800-1000',
                link: 'https://herdade-do-ananas.amenitiz.io/en/booking/room?start_date=2026-05-04&end_date=2026-05-08&adults=2&children=0#RoomSelection-BE',
                pros: ['Individual villas', 'Breakfast included', 'Restaurant on site', 'Jacuzzi', '10min from Ponta Delgada'],
                cons: ['In the city (at least 30 minute drive to any hiking)', 'No amazing Azores views', 'Not as group focused']
            },
            { 
                id: 2, 
                name: 'Ocean View Pool House',
                price: '$2462',
                link: 'https://www.airbnb.com/rooms/1292079482871264815?adults=6&check_in=2026-05-04&check_out=2026-05-08&search_mode=regular_search&source_impression_id=p3_1769383224_P3xl37m9eWqnwqN6&previous_page_section_name=1000&federated_search_id=aefbb495-9622-44f5-be63-2c52553f5e90',
                pros: ['3 beds (1 King, 2 Queens) + 2 baths', 'Pool', 'Ocean views', 'Close to good hikes and beaches', 'Restaurants and supermarket 10â€“15 min away'],
                cons: ['Ponta Delgada 35 min drive', 'Far from anything on the east side of the island']
            },
            { 
                id: 3, 
                name: 'Remote Ocean View Jacuzzi',
                price: '$2000',
                link: 'https://www.airbnb.com/rooms/698653358962531117?adults=6&check_in=2026-05-04&check_out=2026-05-08&search_mode=regular_search&source_impression_id=p3_1769528175_P3Gezhb0MSlYV6tg&previous_page_section_name=1000&federated_search_id=56213585-9343-47e8-a6e0-93fefa3c6539',
                pros: ['3 beds (2 King, 1 Double) + 2 baths', 'Jacuzzi', 'Ocean views', 'Close to beach'],
                cons: ['On the more remote site - 35 minutes from Ponta Delgada', '20 minutes to Furnas/town', '~1hr to Sete Cidades hikes']
            },
            { 
                id: 4, 
                name: 'Furnas Village House',
                price: '$2163',
                link: 'https://www.airbnb.com/rooms/1449214479771010328?source_impression_id=p3_1769381428_P3K9lPuaHoCiPaDN&check_in=2026-05-04&guests=1&adults=1&check_out=2026-05-08',
                pros: ['3 beds 3 baths', 'Close to Furnas thermal pools/hikes', 'In a small village', '15 minutes to beach'],
                cons: ['All beds are 2 twins', '45 minutes from Ponta Delgada', '45-60 minutes to east side of island', 'No pool/jacuzzi']
            },
            { 
                id: 5, 
                name: 'Hotel Pool Access',
                price: '$1750',
                link: 'https://www.airbnb.com/rooms/38060770?adults=6&check_in=2026-05-04&check_out=2026-05-08&search_mode=regular_search&amenities%5B%5D=33&amenities%5B%5D=5&amenities%5B%5D=7&source_impression_id=p3_1769528922_P3ItjercSQIFhpyz&previous_page_section_name=1000&federated_search_id=5ed1afee-b3ab-4201-a370-8e2c755c0b6b',
                pros: ['3 beds + 2 baths', 'Hotel pool + jacuzzi', '20 minutes to Porta Delgada and Sete Cidades hikes'],
                cons: ['1 double; 2 sets of twins (one is a mezzanine room, less private)', '45-60 minutes from hikes on the east side of the island']
            },
            { 
                id: 6, 
                name: 'Luxury Remote Pool Villa',
                price: '$2500',
                link: 'https://www.airbnb.com/rooms/882052971014131303?adults=6&check_in=2026-05-04&check_out=2026-05-08&search_mode=regular_search&amenities%5B%5D=33&amenities%5B%5D=5&amenities%5B%5D=7&source_impression_id=p3_1769528922_P3vAaZPRb47NdT9d&previous_page_section_name=1000&federated_search_id=5ed1afee-b3ab-4201-a370-8e2c755c0b6b',
                pros: ['3 beds (2 queens, 1 king) + 3 baths', 'Pool with amazing ocean views', 'Interior of the house is really nice', '20 minutes to Furnas and eastern edge towns'],
                cons: ['On the more remote side - 40 min from Ponta Delgada', '60 to Sete Cidades', 'More expensive']
            }
        ];

        let currentRanking = [...options];

        // Generate a unique voter ID for this browser
        function getVoterId() {
            let voterId = localStorage.getItem('azores-voter-id');
            if (!voterId) {
                voterId = 'azores_voter_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('azores-voter-id', voterId);
            }
            return voterId;
        }

        async function initializeVoting() {
            try {
                const savedRanking = localStorage.getItem('azores-user-ranking');
                if (savedRanking) {
                    currentRanking = JSON.parse(savedRanking);
                }
            } catch (error) {
                console.log('No saved ranking found, using default order');
            }
            renderRankList();
        }

        function renderRankList() {
            const rankList = document.getElementById('rank-list');
            rankList.innerHTML = '';
            
            currentRanking.forEach((option, index) => {
                const item = document.createElement('div');
                item.className = 'rank-item';
                item.dataset.id = option.id;
                
                const prosHTML = option.pros.map(pro => `<li>${pro}</li>`).join('');
                const consHTML = option.cons.map(con => `<li>${con}</li>`).join('');
                
                const isFirst = index === 0;
                const isLast = index === currentRanking.length - 1;
                
                item.innerHTML = `
                    <span class="rank-number">${index + 1}</span>
                    <div class="rank-content">
                        <div class="option-header">
                            <div class="option-name">${option.name}</div>
                            <div class="option-price">${option.price}</div>
                        </div>
                        <a href="${option.link}" target="_blank" class="option-link" onclick="event.stopPropagation();">
                            ${option.link} â†—
                        </a>
                        <div class="pros-cons-container">
                            <div class="pros-section">
                                <div class="section-label">Pros</div>
                                <ul class="pros-list">${prosHTML}</ul>
                            </div>
                            <div class="cons-section">
                                <div class="section-label">Cons</div>
                                <ul class="cons-list">${consHTML}</ul>
                            </div>
                        </div>
                    </div>
                    <div class="rank-controls">
                        <button class="rank-btn" onclick="moveUp(${index})" ${isFirst ? 'disabled' : ''}>â†‘</button>
                        <button class="rank-btn" onclick="moveDown(${index})" ${isLast ? 'disabled' : ''}>â†“</button>
                    </div>
                `;
                
                rankList.appendChild(item);
            });
        }

        function moveUp(index) {
            if (index > 0) {
                const temp = currentRanking[index];
                currentRanking[index] = currentRanking[index - 1];
                currentRanking[index - 1] = temp;
                renderRankList();
            }
        }

        function moveDown(index) {
            if (index < currentRanking.length - 1) {
                const temp = currentRanking[index];
                currentRanking[index] = currentRanking[index + 1];
                currentRanking[index + 1] = temp;
                renderRankList();
            }
        }

        async function submitVote() {
            try {
                // Check if Google Sheets URL is configured
                if (GOOGLE_SHEET_URL === 'PASTE_YOUR_WEB_APP_URL_HERE') {
                    alert('Google Sheets integration not configured yet. Please add your Web App URL to the code.');
                    return;
                }

                // Save user's ranking locally
                localStorage.setItem('azores-user-ranking', JSON.stringify(currentRanking));
                
                // Check if user has already voted
                const hasVoted = localStorage.getItem('azores-has-voted') === 'true';
                
                if (hasVoted) {
                    alert('You have already submitted a vote! Your preferences have been saved, but your vote was not counted again.');
                    switchView('results');
                    return;
                }

                // Prepare data for Google Sheets
                const voterId = getVoterId();
                const rankings = currentRanking.map((option, index) => ({
                    name: option.name,
                    price: option.price,
                    link: option.link,
                    rank: index + 1,
                    points: 6 - index
                }));

                // Send to Google Sheets
                const response = await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Required for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        voterId: voterId,
                        rankings: rankings
                    })
                });

                // Also save locally for viewing results
                let allVotes = {};
                const votesData = localStorage.getItem('azores-all-votes');
                if (votesData) {
                    allVotes = JSON.parse(votesData);
                }
                
                // Add this vote with weighted scoring
                currentRanking.forEach((option, index) => {
                    const points = 6 - index;
                    if (!allVotes[option.id]) {
                        allVotes[option.id] = { 
                            name: option.name,
                            price: option.price,
                            link: option.link,
                            totalPoints: 0,
                            votes: 0,
                            rankings: { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0 }
                        };
                    }
                    allVotes[option.id].totalPoints += points;
                    allVotes[option.id].votes += 1;
                    allVotes[option.id].rankings[index + 1] += 1;
                });
                
                localStorage.setItem('azores-all-votes', JSON.stringify(allVotes));
                localStorage.setItem('azores-has-voted', 'true');
                
                // Show confirmation
                showConfirmation();
                switchView('results');
                
            } catch (error) {
                console.error('Error submitting vote:', error);
                alert('There was an error submitting your vote to Google Sheets. Please check your internet connection and try again.');
            }
        }

        function showConfirmation() {
            const confirmation = document.createElement('div');
            confirmation.className = 'confirmation';
            confirmation.textContent = 'Vote submitted successfully!';
            document.querySelector('#results-section .voting-area').prepend(confirmation);
            
            setTimeout(() => {
                confirmation.style.animation = 'fadeIn 0.5s ease-out reverse';
                setTimeout(() => confirmation.remove(), 500);
            }, 3000);
        }

        async function loadResults() {
            const container = document.getElementById('results-container');
            
            try {
                const votesData = localStorage.getItem('azores-all-votes');
                
                if (!votesData) {
                    container.innerHTML = '<p class="instruction">No votes have been cast yet. Be the first to vote!</p>';
                    return;
                }
                
                const allVotes = JSON.parse(votesData);
                const results = Object.values(allVotes).sort((a, b) => b.totalPoints - a.totalPoints);
                
                const maxPoints = results[0]?.totalPoints || 1;
                
                container.innerHTML = '';
                results.forEach((result, index) => {
                    const percentage = (result.totalPoints / maxPoints) * 100;
                    
                    const item = document.createElement('div');
                    item.className = 'result-item';
                    item.innerHTML = `
                        <div class="result-header">
                            <div class="result-name">${result.name}</div>
                            <div class="result-score">${result.totalPoints}</div>
                        </div>
                        <div class="result-bar-container">
                            <div class="result-bar" style="width: ${percentage}%"></div>
                        </div>
                        <div class="result-details">
                            <span>Votes: ${result.votes}</span>
                            <span>Avg Rank: ${(result.votes > 0 ? (7 - result.totalPoints / result.votes).toFixed(1) : 'N/A')}</span>
                            <span>1st Choice: ${result.rankings[1]} times</span>
                        </div>
                    `;
                    container.appendChild(item);
                });
            } catch (error) {
                console.log('No votes found:', error);
                container.innerHTML = '<p class="instruction">No votes have been cast yet. Be the first to vote!</p>';
            }
        }

        function switchView(view) {
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.section').forEach(section => section.classList.remove('active'));
            
            if (view === 'vote') {
                document.querySelector('.toggle-btn:first-child').classList.add('active');
                document.getElementById('vote-section').classList.add('active');
            } else {
                document.querySelector('.toggle-btn:last-child').classList.add('active');
                document.getElementById('results-section').classList.add('active');
                loadResults();
            }
        }

        // Initialize on load
        initializeVoting();
    </script>
</body>
</html>
